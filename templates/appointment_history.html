{% extends "base.html" %}
{% block title %}Appointment History{% endblock %}
{% block content %}
<h2 class="mb-4 section-title">Appointment History</h2>
<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Doctor</th>
            <th>Department</th>
            <th>Status</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          {% for appointment in appointments %}
          <tr class="{% if highlight and highlight.id == appointment.id %}table-active{% endif %}">
            <td>{{ appointment.date }}</td>
            <td>{{ appointment.time }}</td>
            <td>{{ appointment.doctor.name }}</td>
            <td>{{ appointment.doctor.department.name }}</td>
            <td>
              {% if appointment.status == 'Booked' %}
              <span class="badge badge-soft-primary">{{ appointment.status }}</span>
              {% elif appointment.status == 'Completed' %}
              <span class="badge badge-soft-success">{{ appointment.status }}</span>
              {% else %}
              <span class="badge badge-soft-danger">{{ appointment.status }}</span>
              {% endif %}
            </td>
            <td>
              {% if appointment.status == 'Booked' %}
              <a href="{{ url_for('reschedule_appointment', appointment_id=appointment.id) }}"
                class="btn btn-sm btn-warning">Reschedule</a>
              {% elif appointment.status == 'Completed' and appointment.treatment %}
              <a class="btn btn-sm btn-outline-primary"
                href="{{ url_for('appointment_history', show=appointment.id) }}">View</a>
              {% else %}
              <span class="text-muted">â€”</span>
              {% endif %}
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="6" class="text-center text-muted">No appointment history</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% if highlight and highlight.treatment %}
<div class="card mt-3">
  <div class="card-body">
    <h5 class="card-title">Appointment Details</h5>
    <p class="mb-1"><strong>Date & Time:</strong> {{ highlight.date }} {{ highlight.time }}</p>
    <p class="mb-1"><strong>Doctor:</strong> Dr. {{ highlight.doctor.name }} ({{ highlight.doctor.department.name }})</p>
    <hr>
    <p class="mb-1"><strong>Diagnosis:</strong></p>
    <p>{{ highlight.treatment.diagnosis }}</p>
    <p class="mb-1"><strong>Prescription:</strong></p>
    <p>{{ highlight.treatment.prescription }}</p>
    {% if highlight.treatment.notes %}
      <p class="mb-1"><strong>Additional Notes:</strong></p>
      <p>{{ highlight.treatment.notes }}</p>
    {% endif %}
    <a href="{{ url_for('appointment_history') }}" class="btn btn-secondary mt-2">Close</a>
  </div>
</div>
{% endif %}
{% endblock %}